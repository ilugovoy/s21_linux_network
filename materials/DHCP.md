## Протокол DHCP  

DHCP - это протокол прикладного уровня TCP/IP, который используется для назначения IP-адреса клиенту. IP-адрес может быть назначен вручную каждому клиенту, т.е. каждому компьютеру в локальной сети. Однако в крупных сетях это очень утомительно и, соответственно, вероятность ошибки настройки увеличивается. Поэтому был создан протокол **DHCP** для автоматизации назначения IP-адресов.

Процесс назначения IP-адреса на английском называется **DORA** - по первым буквам четырех шагов:  

1. Определение (Discovery)  
2. Предложение (Offer)  
3. Запрос (Request)  
4. Подтверждение (Acknowledgement)  
  
<img src="../misc/images/dhcp.png" alt="network_route" width="500"/>

#### Опции DHCP  

Клиент не только получает IP-адрес, но и другие настройки **DHCP** для работы в локальной сети. Опции представляют собой номерные пункты, строки данных, содержащие параметры конфигурации, необходимые серверу.

Некоторые из опций:

* Опция 1 - маска подсети  
* Опция 3 - IP-адрес шлюза по умолчанию  
* Опция 6 - DNS-сервер (первичный и резервный)  
* Опция 51 определяет, какую продолжительность будет иметь аренда IP-адреса клиентом  
* Опция 55 - список запрошенных опций. Клиент всегда запрашивает опции для правильной настройки    

Отправкой сообщения с опцией 55 клиент устанавливает список номерных кодов запрашиваемых опций в порядке предпочтения.  
Сервер **DHCP** пытается отправить ответ с опциями в том же порядке.

##  Форсирование обновления IP-адреса DHCP-клиента (dhclient)

Для этого нужно использовать команду Dynamic Host Configuration Protocol Client, то есть `dhclient`  
Клиент обычно не освобождает текущую аренду, так как это не требуется протоколом DHCP  
Некоторые кабельные интернет-провайдеры требуют, чтобы их клиенты уведомляли сервер, если они хотят освободить назначенный IP-адрес  
Команда `dhclient` предоставляет средство для настройки одного или нескольких сетевых интерфейсов с использованием протокола Dynamic Host Configuration Protocol, протокола BOOTP или, в случае отказа от этих протоколов, путем статического назначения адреса 

Давайте рассмотрим команду Linux для принудительного освобождения IP-адреса DHCP-клиента  

*Предупреждение: Освобождение вашего IP-адреса всегда отключает ваш сетевой интерфейс/Wi-Fi  
Так что будьте осторожны с удаленными системами.*  

Флаг *-r* явно освобождает текущую аренду, и после освобождения аренды клиент завершает работу  

Например, откройте терминальное приложение и введите команду:  
```shell  
$ sudo dhclient -r  
```
Теперь получите новый IP-адрес с помощью DHCP в Linux:  
```shell  
$ sudo dhclient  
```

Чтобы обновить или освободить IP-адрес для конкретного интерфейса, например eth0, введите:
```shell  
$ sudo dhclient -r eth0
$ sudo dhclient eth0
```